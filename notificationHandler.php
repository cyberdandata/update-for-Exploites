<?php
header('Content-Type: application/json');

// Path to the notifications data file
$dataFile = 'notifications.json';

// Handle actions
$action = $_GET['action'] ?? '';

if ($action === 'add') {
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $text = $_POST['text'] ?? ''; // Get notification text
        $duration = $_POST['duration'] ?? ''; // Get duration
        
        if (empty($text) || empty($duration)) {
            echo json_encode(['success' => false, 'message' => 'Text or Duration cannot be empty.']);
            exit;
        }

        // Load existing notifications
        $data = file_exists($dataFile) ? json_decode(file_get_contents($dataFile), true) : [];

        // Add the new notification
        $data[] = [
            'id' => uniqid(),
            'text' => $text,
            'duration' => $duration
        ];

        // Save the updated data back to the notifications.json file
        if (file_put_contents($dataFile, json_encode($data))) {
            echo json_encode(['success' => true, 'message' => 'Notification added successfully.']);
        } else {
            echo json_encode(['success' => false, 'message' => 'Failed to save notification.']);
        }
    } else {
        echo json_encode(['success' => false, 'message' => 'Invalid request method']);
    }
} elseif ($action === 'load') {
    // Load and display notifications
    $data = file_exists($dataFile) ? json_decode(file_get_contents($dataFile), true) : [];
    echo json_encode($data); // Return the notifications as JSON
} elseif ($action === 'delete') {
    // Handle delete action
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $id = $_POST['id'];
        $data = file_exists($dataFile) ? json_decode(file_get_contents($dataFile), true) : [];

        // Filter out the notification to delete
        $filteredData = array_filter($data, function($notification) use ($id) {
            return $notification['id'] !== $id;
        });

        // Save the updated data back to the JSON file
        if (file_put_contents($dataFile, json_encode(array_values($filteredData)))) {
            echo json_encode(['success' => true, 'message' => 'Notification deleted successfully.']);
        } else {
            echo json_encode(['success' => false, 'message' => 'Failed to delete notification.']);
        }
    }
} else {
    echo json_encode(['success' => false, 'message' => 'Invalid action']);
}
?>
